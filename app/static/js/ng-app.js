"use strict";!function(){angular.module("apox",[])}(),function(){var o=angular.module("apox");o.controller("HelloController",function(){var o=this;o.greeting="Welcome to the Apocalypse, "})}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(o){var t=this;t.location={},t.mapData={},t.showDetailPanel=!0,t.dataLoaded=!1,t.closeDetailPanel=function(){t.showDetailPanel=!1},t.loadMapData=function(){o.get("/map").then(function(o){t.mapData.locations=o.data.locations,t.mapData.connections=o.data.connections,t.dataLoaded=!0})},t.updateLocationDetails=function(){var n=t.location;n.id>0&&o.patch("/admin/map/location/"+n.id,{name:n.name,longitude:n.longitude,latitude:n.latitude,description:n.description,population:n.population,tech:n.tech,type:n.type}).then(function(){})},t.loadMapData()}]),angular.module("apox").directive("adminmap",function(){function o(o){return new paper.Point(o.longitude*p+u,o.latitude*s+d)}function t(o){return{longitude:(o.x-u)/p,latitude:(o.y-d)/s}}function n(o){o.target.children.locname.visible=!0}function a(o){o.target.children.locname.visible=!1}function e(o){o.target.children.dot.fillColor.alpha=.5,o.target.scope.$apply(function(){o.target.scope.admin.location=o.target.location})}function i(o){o.target.children.dot.fillColor.alpha=1,o.preventDefault()}function l(o){var n=o.target;n.position=n.position.add([o.delta.x,o.delta.y]);var a=t(n.position);n.location.longitude=a.longitude,n.location.latitude=a.latitude,n.scope.$apply(function(){n.scope.admin.location.longitude=a.longitude,n.scope.admin.location.latitude=a.latitude});for(var e=0;e<n.location.paths.length;e++)n.location.paths[e].x=n.children.dot.position.x,n.location.paths[e].y=n.children.dot.position.y;o.stopPropagation()}var c=3,r=3,p=435.3,s=-506.5,u=43647,d=15855;return{restrict:"A",controller:"AdminMapController",controllerAs:"admin",link:function(t,p){paper.setup(p.context);var s=new paper.Layer;s.texasMap=new paper.Raster("/img/texasmap.jpg"),t.$watch("admin.dataLoaded",function(){var p=t.admin.mapData;p.locations&&p.connections&&!function(){Object.keys(p.locations).forEach(function(t){p.locations[t].point=o(p.locations[t]),p.locations[t].paths=[]});for(var s=0;s<p.connections.length;s++){var u=p.connections[s],d=p.locations[u.loc1],f=p.locations[u.loc2],h=new paper.Path.Line(d.point,f.point);h.strokeColor="black",h.strokeWidth=r,d.paths.push(h.segments[0].point),f.paths.push(h.segments[1].point)}var m=new paper.Point(0,(-15));Object.keys(p.locations).forEach(function(o){var r=p.locations[o],s=new paper.Path.Circle({center:r.point,radius:c*Math.ceil(Math.log10(r.population)),fillColor:"black",name:"dot"}),u=new paper.PointText(r.point+m);u.justification="center",u.fillColor="#3333ff",u.strokeColor="#9999cc",u.content=r.name,u.name="locname",u.visible=!1,u.fontSize=24;var d=new paper.Group([s,u]);d.location=r,d.scope=t,d.onMouseEnter=n,d.onMouseLeave=a,d.onMouseDrag=l,d.onMouseDown=e,d.onMouseUp=i})}()});var u=new paper.Tool;u.onMouseDrag=function(o){s.position=s.position.add([o.delta.x,o.delta.y])},paper.view.center=new paper.Point(1100,500)}}})}();