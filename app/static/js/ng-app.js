"use strict";!function(){angular.module("apox",[])}(),function(){var t=function(t){var o=this;o.location={},o.mapData={},o.showDetailPanel=!0,o.dataLoaded=!1,o.closeDetailPanel=function(){o.showDetailPanel=!1},o.loadMapData=function(){t.getMap().then(function(t){o.mapData.locations=t.data.locations,o.mapData.connections=t.data.connections,o.dataLoaded=!0})},o.updateLocationDetails=function(){var a=o.location;a.id>0&&t.updateLocation(a.id,{name:a.name,longitude:a.longitude,latitude:a.latitude,description:a.description,population:a.population,tech:a.tech,type:a.type})},o.loadMapData()};angular.module("apox").controller("AdminMapController",["MapService",t])}(),function(){angular.module("apox").directive("apoxAdminMap",function(){function t(t){return new paper.Point(t.longitude*s+f,t.latitude*d+v)}function o(t){return{longitude:(t.x-f)/s,latitude:(t.y-v)/d}}function a(t){var o=t.target.parent;t.target.remove(),o.addChild(t.target),t.target.children.dot.fillColor.alpha=.5;for(var a=0;a<t.target.location.paths.length;a++)t.target.location.paths[a].strokeColor=g;t.target.scope.$apply(function(){t.target.scope.admin.showDetailPanel=!0,t.target.scope.admin.location=t.target.location})}function n(t){t.target.children.dot.fillColor.alpha=1;for(var o=0;o<t.target.location.paths.length;o++)t.target.location.paths[o].strokeColor="black"}function e(t){var a=t.target;a.position=a.position.add([t.delta.x,t.delta.y]);for(var n=0;n<a.location.paths.length;n++)a.location.ends[n].x=a.children.dot.position.x,a.location.ends[n].y=a.children.dot.position.y;var e=o(a.position);a.location.longitude=e.longitude,a.location.latitude=e.latitude,a.scope.$apply(function(){a.scope.admin.location.longitude=e.longitude,a.scope.admin.location.latitude=e.latitude}),t.stopPropagation()}function i(t){t.target.children.locname.visible=!0}function r(t){t.target.children.locname.visible=!1}function l(t,o,a,n){var e=1.05,i=t;o>0&&(i*=e),o<0&&(i/=e);var r=t/i,l=n.subtract(a),c=n.subtract(l.multiply(r)).subtract(a);return{newZoom:i,a:c}}function c(t,o,a,n){var e=new paper.Point(o,a).multiply(n);return t.subtract(e)}var p=3,u=3,s=435.3,d=-506.5,f=43647,v=15855,g=new paper.Color(0,0,0,.5);return{restrict:"E",template:'<canvas class="map-canvas" resize="true"></canvas>',link:function(o,s){paper.setup(s.context.firstChild);var d=new paper.Layer;d.texasMap=new paper.Raster("/img/texasmap.jpg"),o.$watch("admin.dataLoaded",function(){var l=o.admin.mapData;l.locations&&l.connections&&!function(){Object.keys(l.locations).forEach(function(o){l.locations[o].point=t(l.locations[o]),l.locations[o].paths=[],l.locations[o].ends=[]});for(var c=0;c<l.connections.length;c++){var s=l.connections[c],d=l.locations[s.loc1],f=l.locations[s.loc2],v=new paper.Path.Line(d.point,f.point);v.strokeColor="black",v.strokeWidth=u,d.ends.push(v.segments[0].point),f.ends.push(v.segments[1].point),d.paths.push(v),f.paths.push(v)}var g=[0,-20],h=Object.keys(l.locations);h.forEach(function(t){var c=l.locations[t],u=new paper.Path.Circle({center:c.point,radius:p*Math.ceil(Math.log10(c.population)),fillColor:"black",name:"dot"}),s=new paper.PointText(c.point.add(g));s.justification="center",s.fillColor="#3333ff",s.strokeColor="#9999cc",s.content=c.name,s.name="locname",s.visible=!1,s.fontSize=24;var d=new paper.Group([u,s]);d.location=c,d.scope=o,d.onMouseEnter=i,d.onMouseLeave=r,d.onMouseDrag=e,d.onMouseDown=a,d.onMouseUp=n})}()}),d.onMouseDrag=function(t){d.position=d.position.add([t.delta.x,t.delta.y])},paper.view.center=new paper.Point(1100,500),s.bind("mousewheel",function(t){var o=t.originalEvent.wheelDeltaX,a=t.originalEvent.wheelDeltaY;if(t.altKey){var n=new paper.Point(t.offsetX,t.offsetY),e=l(paper.view.zoom,a,paper.view.center,n);paper.view.zoom=e.newZoom,t.preventDefault()}else paper.view.center=c(paper.view.center,o,a,1),t.preventDefault()})}}})}(),function(){var t=function(t){var o=this;t.getDriver().then(function(t){o.driver=t.data}),o.currentLocation={name:"Buttsville"}};angular.module("apox").controller("GamePageController",["DriverService",t])}(),function(){var t=function(t){return{getDriver:function(){return t.get("/driver")}}};angular.module("apox").factory("DriverService",["$http",t])}(),function(){var t=function(t){return{getMap:function(){return t.get("/map")},updateLocation:function(o,a){return t.patch("/admin/map/location/"+o,a)}}};angular.module("apox").factory("MapService",["$http",t])}();