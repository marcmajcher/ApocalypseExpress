"use strict";!function(){angular.module("apox",[])}(),function(){var t=angular.module("apox");t.controller("HelloController",function(){var t=this;t.greeting="Welcome to the Apocalypse, "})}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(t){var o=this;o.location={},o.mapData={},o.showDetailPanel=!0,o.dataLoaded=!1,o.closeDetailPanel=function(){o.showDetailPanel=!1},o.loadMapData=function(){t.get("/map").then(function(t){o.mapData.locations=t.data.locations,o.mapData.connections=t.data.connections,o.dataLoaded=!0})},o.updateLocationDetails=function(){var n=o.location;n.id>0&&t.patch("/admin/map/location/"+n.id,{name:n.name,longitude:n.longitude,latitude:n.latitude,description:n.description,population:n.population,tech:n.tech,type:n.type}).then(function(){})},o.loadMapData()}]),angular.module("apox").directive("adminmap",function(){function t(t){return new paper.Point(t.longitude*p+u,t.latitude*s+d)}function o(t){return{longitude:(t.x-u)/p,latitude:(t.y-d)/s}}function n(t){t.target.children.locname.visible=!0}function a(t){t.target.children.locname.visible=!1}function e(t){t.target.children.dot.fillColor.alpha=.5,t.target.scope.$apply(function(){t.target.scope.admin.location=t.target.location})}function i(t){t.target.children.dot.fillColor.alpha=1,t.preventDefault()}function l(t){var n=t.target;n.position+=t.delta;var a=o(n.position);n.location.longitude=a.longitude,n.location.latitude=a.latitude,$("#detailPanel #locx").val(n.location.latitude),$("#detailPanel #locy").val(n.location.longitude);for(var e=0;e<n.location.paths.length;e++)n.location.paths[e].x=n.children.dot.position.x,n.location.paths[e].y=n.children.dot.position.y;t.stopPropagation()}var c=3,r=3,p=435.3,s=-506.5,u=43647,d=15855;return{restrict:"A",controller:"AdminMapController",controllerAs:"admin",link:function(o,p){paper.setup(p.get(0));var s=new paper.Layer;s.texasMap=new paper.Raster("/img/texasmap.jpg"),o.$watch("admin.dataLoaded",function(){var p=o.admin.mapData;p.locations&&p.connections&&!function(){Object.keys(p.locations).forEach(function(o){p.locations[o].point=t(p.locations[o]),p.locations[o].paths=[]});for(var s=0;s<p.connections.length;s++){var u=p.connections[s],d=p.locations[u.loc1],f=p.locations[u.loc2],h=new paper.Path.Line(d.point,f.point);h.strokeColor="black",h.strokeWidth=r,d.paths.push(h.segments[0].point),f.paths.push(h.segments[1].point)}var g=new paper.Point(0,(-15));Object.keys(p.locations).forEach(function(t){var r=p.locations[t],s=new paper.Path.Circle({center:r.point,radius:c*Math.ceil(Math.log10(r.population)),fillColor:"black",name:"dot"}),u=new paper.PointText(r.point+g);u.justification="center",u.fillColor="#3333ff",u.strokeColor="#9999cc",u.content=r.name,u.name="locname",u.visible=!1,u.fontSize=24;var d=new paper.Group([s,u]);d.location=r,d.scope=o,d.onMouseEnter=n,d.onMouseLeave=a,d.onMouseDrag=l,d.onMouseDown=e,d.onMouseUp=i})}()}),s.onMouseDrag=function(t){t.target.position+=t.delta,paper.project.view.update()},paper.view.center=new paper.Point(1100,500)}}})}();