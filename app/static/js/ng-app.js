"use strict";!function(){angular.module("apox",[])}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(o){var t=this;t.location={},t.mapData={},t.showDetailPanel=!0,t.dataLoaded=!1,t.closeDetailPanel=function(){t.showDetailPanel=!1},t.loadMapData=function(){o.get("/map").then(function(o){t.mapData.locations=o.data.locations,t.mapData.connections=o.data.connections,t.dataLoaded=!0})},t.updateLocationDetails=function(){var n=t.location;n.id>0&&o.patch("/admin/map/location/"+n.id,{name:n.name,longitude:n.longitude,latitude:n.latitude,description:n.description,population:n.population,tech:n.tech,type:n.type}).then(function(){})},t.loadMapData()}]),angular.module("apox").directive("adminmap",function(){function o(o){return new paper.Point(o.longitude*r+d,o.latitude*s+u)}function t(o){return{longitude:(o.x-d)/r,latitude:(o.y-u)/s}}function n(o){o.target.children.locname.visible=!0}function a(o){o.target.children.locname.visible=!1}function e(o){o.target.children.dot.fillColor.alpha=.5,o.target.scope.$apply(function(){o.target.scope.admin.location=o.target.location})}function i(o){o.target.children.dot.fillColor.alpha=1,o.preventDefault()}function l(o){var n=o.target;console.log(n),console.log(n.position),console.log("POS ",n.position.x,n.position.y),n.position=n.position.add([o.delta.x,o.delta.y]);var a=t(n.position);n.location.longitude=a.longitude,n.location.latitude=a.latitude;for(var e=0;e<n.location.paths.length;e++)n.location.paths[e].x=n.children.dot.position.x,n.location.paths[e].y=n.children.dot.position.y;n.scope.$apply(function(){n.scope.admin.location.longitude=a.longitude,n.scope.admin.location.latitude=a.latitude}),o.stopPropagation()}var c=3,p=3,r=435.3,s=-506.5,d=43647,u=15855;return{restrict:"A",controller:"AdminMapController",controllerAs:"admin",link:function(t,r){paper.setup(r.context);var s=new paper.Layer;s.texasMap=new paper.Raster("/img/texasmap.jpg"),t.$watch("admin.dataLoaded",function(){var r=t.admin.mapData;r.locations&&r.connections&&!function(){Object.keys(r.locations).forEach(function(t){r.locations[t].point=o(r.locations[t]),r.locations[t].paths=[]});for(var s=0;s<r.connections.length;s++){var d=r.connections[s],u=r.locations[d.loc1],f=r.locations[d.loc2],h=new paper.Path.Line(u.point,f.point);h.strokeColor="black",h.strokeWidth=p,u.paths.push(h.segments[0].point),f.paths.push(h.segments[1].point)}var g=[0,-20];Object.keys(r.locations).forEach(function(o){var p=r.locations[o],s=new paper.Path.Circle({center:p.point,radius:c*Math.ceil(Math.log10(p.population)),fillColor:"black",name:"dot"}),d=new paper.PointText(p.point.add(g));d.justification="center",d.fillColor="#3333ff",d.strokeColor="#9999cc",d.content=p.name,d.name="locname",d.visible=!1,d.fontSize=24;var u=new paper.Group([s,d]);u.location=p,u.scope=t,u.onMouseEnter=n,u.onMouseLeave=a,u.onMouseDrag=l,u.onMouseDown=e,u.onMouseUp=i})}()}),s.onMouseDrag=function(o){s.position=s.position.add([o.delta.x,o.delta.y])},paper.view.center=new paper.Point(1100,500)}}})}();