"use strict";!function(){angular.module("apox",[])}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(t){var o=this;o.location={},o.mapData={},o.showDetailPanel=!0,o.dataLoaded=!1,o.closeDetailPanel=function(){o.showDetailPanel=!1},o.loadMapData=function(){t.get("/map").then(function(t){o.mapData.locations=t.data.locations,o.mapData.connections=t.data.connections,o.dataLoaded=!0})},o.updateLocationDetails=function(){var n=o.location;n.id>0&&t.patch("/admin/map/location/"+n.id,{name:n.name,longitude:n.longitude,latitude:n.latitude,description:n.description,population:n.population,tech:n.tech,type:n.type}).then(function(){})},o.loadMapData()}]),angular.module("apox").directive("adminmap",function(){function t(t){return new paper.Point(t.longitude*r+d,t.latitude*s+u)}function o(t){return{longitude:(t.x-d)/r,latitude:(t.y-u)/s}}function n(t){t.target.children.locname.visible=!0}function a(t){t.target.children.locname.visible=!1}function e(t){t.target.children.dot.fillColor.alpha=.5,t.target.scope.$apply(function(){t.target.scope.admin.location=t.target.location})}function i(t){t.target.children.dot.fillColor.alpha=1,t.preventDefault()}function l(t){var n=t.target;n.position=n.position.add([t.delta.x,t.delta.y]);var a=o(n.position);n.location.longitude=a.longitude,n.location.latitude=a.latitude;for(var e=0;e<n.location.paths.length;e++)n.location.paths[e].x=n.children.dot.position.x,n.location.paths[e].y=n.children.dot.position.y;n.scope.$apply(function(){n.scope.admin.location.longitude=a.longitude,n.scope.admin.location.latitude=a.latitude}),t.stopPropagation()}var c=3,p=3,r=435.3,s=-506.5,d=43647,u=15855;return{restrict:"A",controller:"AdminMapController",controllerAs:"admin",link:function(o,r){paper.setup(r.context);var s=new paper.Layer;s.texasMap=new paper.Raster("/img/texasmap.jpg"),o.$watch("admin.dataLoaded",function(){var r=o.admin.mapData;r.locations&&r.connections&&!function(){Object.keys(r.locations).forEach(function(o){r.locations[o].point=t(r.locations[o]),r.locations[o].paths=[]});for(var s=0;s<r.connections.length;s++){var d=r.connections[s],u=r.locations[d.loc1],f=r.locations[d.loc2],h=new paper.Path.Line(u.point,f.point);h.strokeColor="black",h.strokeWidth=p,u.paths.push(h.segments[0].point),f.paths.push(h.segments[1].point)}var m=[0,-20];Object.keys(r.locations).forEach(function(t){var p=r.locations[t],s=new paper.Path.Circle({center:p.point,radius:c*Math.ceil(Math.log10(p.population)),fillColor:"black",name:"dot"}),d=new paper.PointText(p.point.add(m));d.justification="center",d.fillColor="#3333ff",d.strokeColor="#9999cc",d.content=p.name,d.name="locname",d.visible=!1,d.fontSize=24;var u=new paper.Group([s,d]);u.location=p,u.scope=o,u.onMouseEnter=n,u.onMouseLeave=a,u.onMouseDrag=l,u.onMouseDown=e,u.onMouseUp=i})}()}),s.onMouseDrag=function(t){s.position=s.position.add([t.delta.x,t.delta.y])},paper.view.center=new paper.Point(1100,500)}}})}();