"use strict";!function(){angular.module("apox",[])}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(t){var o=this;o.location={},o.mapData={},o.showDetailPanel=!0,o.dataLoaded=!1,o.closeDetailPanel=function(){o.showDetailPanel=!1},o.loadMapData=function(){t.get("/map").then(function(t){o.mapData.locations=t.data.locations,o.mapData.connections=t.data.connections,o.dataLoaded=!0})},o.updateLocationDetails=function(){var n=o.location;n.id>0&&t.patch("/admin/map/location/"+n.id,{name:n.name,longitude:n.longitude,latitude:n.latitude,description:n.description,population:n.population,tech:n.tech,type:n.type}).then(function(){})},o.loadMapData()}]),angular.module("apox").directive("adminmap",function(){function t(t){return new paper.Point(t.longitude*p+d,t.latitude*s+u)}function o(t){return{longitude:(t.x-d)/p,latitude:(t.y-u)/s}}function n(t){var o=t.target.parent;t.target.remove(),o.addChild(t.target),t.target.children.dot.fillColor.alpha=.5;for(var n=0;n<t.target.location.paths.length;n++)t.target.location.paths[n].strokeColor=h;t.target.scope.$apply(function(){t.target.scope.admin.location=t.target.location})}function a(t){t.target.children.dot.fillColor.alpha=1;for(var o=0;o<t.target.location.paths.length;o++)t.target.location.paths[o].strokeColor="black"}function e(t){var n=t.target;n.position=n.position.add([t.delta.x,t.delta.y]);for(var a=0;a<n.location.paths.length;a++)n.location.ends[a].x=n.children.dot.position.x,n.location.ends[a].y=n.children.dot.position.y;var e=o(n.position);n.location.longitude=e.longitude,n.location.latitude=e.latitude,n.scope.$apply(function(){n.scope.admin.location.longitude=location.longitude,n.scope.admin.location.latitude=location.latitude}),t.stopPropagation()}function i(t){t.target.children.locname.visible=!0}function l(t){t.target.children.locname.visible=!1}var c=3,r=3,p=435.3,s=-506.5,d=43647,u=15855,h=new paper.Color(0,0,0,.5);return{restrict:"A",controller:"AdminMapController",controllerAs:"admin",link:function(o,p){paper.setup(p.context);var s=new paper.Layer;s.texasMap=new paper.Raster("/img/texasmap.jpg"),o.$watch("admin.dataLoaded",function(){var p=o.admin.mapData;p.locations&&p.connections&&!function(){Object.keys(p.locations).forEach(function(o){p.locations[o].point=t(p.locations[o]),p.locations[o].paths=[],p.locations[o].ends=[]});for(var s=0;s<p.connections.length;s++){var d=p.connections[s],u=p.locations[d.loc1],h=p.locations[d.loc2],g=new paper.Path.Line(u.point,h.point);g.strokeColor="black",g.strokeWidth=r,u.ends.push(g.segments[0].point),h.ends.push(g.segments[1].point),u.paths.push(g),h.paths.push(g)}var f=[0,-20],m=Object.keys(p.locations);m.forEach(function(t){var r=p.locations[t],s=new paper.Path.Circle({center:r.point,radius:c*Math.ceil(Math.log10(r.population)),fillColor:"black",name:"dot"}),d=new paper.PointText(r.point.add(f));d.justification="center",d.fillColor="#3333ff",d.strokeColor="#9999cc",d.content=r.name,d.name="locname",d.visible=!1,d.fontSize=24;var u=new paper.Group([s,d]);u.location=r,u.scope=o,u.onMouseEnter=i,u.onMouseLeave=l,u.onMouseDrag=e,u.onMouseDown=n,u.onMouseUp=a})}()}),s.onMouseDrag=function(t){s.position=s.position.add([t.delta.x,t.delta.y])},paper.view.center=new paper.Point(1100,500)}}})}();