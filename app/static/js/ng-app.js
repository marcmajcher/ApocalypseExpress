"use strict";!function(){angular.module("apox",[])}(),function(){var t=function(){var t=this;t.driver={name:"Barney"},t.currentLocation={name:"Buttsville"}};angular.module("apox").controller("GamePageController",["$http",t])}(),function(){var t=function(t){var o=this;o.location={},o.mapData={},o.showDetailPanel=!0,o.dataLoaded=!1,o.closeDetailPanel=function(){o.showDetailPanel=!1},o.loadMapData=function(){t.get("/map").then(function(t){o.mapData.locations=t.data.locations,o.mapData.connections=t.data.connections,o.dataLoaded=!0})},o.updateLocationDetails=function(){var a=o.location;a.id>0&&t.patch("/admin/map/location/"+a.id,{name:a.name,longitude:a.longitude,latitude:a.latitude,description:a.description,population:a.population,tech:a.tech,type:a.type}).then(function(){})},o.loadMapData()};angular.module("apox").controller("AdminMapController",["$http",t])}(),function(){angular.module("apox").directive("apoxAdminMap",function(){function t(t){return new paper.Point(t.longitude*u+f,t.latitude*d+h)}function o(t){return{longitude:(t.x-f)/u,latitude:(t.y-h)/d}}function a(t){var o=t.target.parent;t.target.remove(),o.addChild(t.target),t.target.children.dot.fillColor.alpha=.5;for(var a=0;a<t.target.location.paths.length;a++)t.target.location.paths[a].strokeColor=v;t.target.scope.$apply(function(){t.target.scope.admin.showDetailPanel=!0,t.target.scope.admin.location=t.target.location})}function n(t){t.target.children.dot.fillColor.alpha=1;for(var o=0;o<t.target.location.paths.length;o++)t.target.location.paths[o].strokeColor="black"}function e(t){var a=t.target;a.position=a.position.add([t.delta.x,t.delta.y]);for(var n=0;n<a.location.paths.length;n++)a.location.ends[n].x=a.children.dot.position.x,a.location.ends[n].y=a.children.dot.position.y;var e=o(a.position);a.location.longitude=e.longitude,a.location.latitude=e.latitude,a.scope.$apply(function(){a.scope.admin.location.longitude=e.longitude,a.scope.admin.location.latitude=e.latitude}),t.stopPropagation()}function i(t){t.target.children.locname.visible=!0}function l(t){t.target.children.locname.visible=!1}function r(t,o,a,n){var e=1.05,i=t;o>0&&(i*=e),o<0&&(i/=e);var l=t/i,r=n.subtract(a),c=n.subtract(r.multiply(l)).subtract(a);return{newZoom:i,a:c}}function c(t,o,a,n){var e=new paper.Point(o,a).multiply(n);return t.subtract(e)}var p=3,s=3,u=435.3,d=-506.5,f=43647,h=15855,v=new paper.Color(0,0,0,.5);return{restrict:"E",template:'<canvas class="map-canvas" resize="true"></canvas>',link:function(o,u){paper.setup(u.context.firstChild);var d=new paper.Layer;d.texasMap=new paper.Raster("/img/texasmap.jpg"),o.$watch("admin.dataLoaded",function(){var r=o.admin.mapData;r.locations&&r.connections&&!function(){Object.keys(r.locations).forEach(function(o){r.locations[o].point=t(r.locations[o]),r.locations[o].paths=[],r.locations[o].ends=[]});for(var c=0;c<r.connections.length;c++){var u=r.connections[c],d=r.locations[u.loc1],f=r.locations[u.loc2],h=new paper.Path.Line(d.point,f.point);h.strokeColor="black",h.strokeWidth=s,d.ends.push(h.segments[0].point),f.ends.push(h.segments[1].point),d.paths.push(h),f.paths.push(h)}var v=[0,-20],g=Object.keys(r.locations);g.forEach(function(t){var c=r.locations[t],s=new paper.Path.Circle({center:c.point,radius:p*Math.ceil(Math.log10(c.population)),fillColor:"black",name:"dot"}),u=new paper.PointText(c.point.add(v));u.justification="center",u.fillColor="#3333ff",u.strokeColor="#9999cc",u.content=c.name,u.name="locname",u.visible=!1,u.fontSize=24;var d=new paper.Group([s,u]);d.location=c,d.scope=o,d.onMouseEnter=i,d.onMouseLeave=l,d.onMouseDrag=e,d.onMouseDown=a,d.onMouseUp=n})}()}),d.onMouseDrag=function(t){d.position=d.position.add([t.delta.x,t.delta.y])},paper.view.center=new paper.Point(1100,500),u.bind("mousewheel",function(t){var o=t.originalEvent.wheelDeltaX,a=t.originalEvent.wheelDeltaY;if(t.altKey){var n=new paper.Point(t.offsetX,t.offsetY),e=r(paper.view.zoom,a,paper.view.center,n);paper.view.zoom=e.newZoom,t.preventDefault()}else paper.view.center=c(paper.view.center,o,a,1),t.preventDefault()})}}})}();