"use strict";!function(){angular.module("apox",[]),angular.module("apox").directive("draw",function(){function t(t){return new paper.Point(t.longitude*h+m,t.latitude*g+P)}function e(t){return{longitude:(t.x-m)/h,latitude:(t.y-P)/g}}function n(t){t.target.children.locname.visible=!0}function a(t){t.target.children.locname.visible=!1}function o(t){$("#detailPanel #longitude").val(t.longitude),$("#detailPanel #latitude").val(t.latitude)}function l(t){t.target.children.dot.fillColor.alpha=.5;var e=t.target.location;$("#detailPanel").addClass("out"),$("#detailPanel #locid").val(e.id),$("#detailPanel #name").val(e.name),$("#detailPanel #description").val(e.description),$("#detailPanel #population").val(e.population),$("#detailPanel #tech").val(e.tech),$("#detailPanel #type").val(e.type),o(e)}function i(t){t.target.children.dot.fillColor.alpha=1,t.preventDefault()}function r(t){var n=t.target;n.position+=t.delta;var a=e(n.position);n.location.longitude=a.longitude,n.location.latitude=a.latitude,$("#detailPanel #locx").val(n.location.latitude),$("#detailPanel #locy").val(n.location.longitude);for(var l=0;l<n.location.paths.length;l++)n.location.paths[l].x=n.children.dot.position.x,n.location.paths[l].y=n.children.dot.position.y;o(a),t.stopPropagation()}function c(e){Object.keys(e.locations).forEach(function(n){e.locations[n].point=t(e.locations[n]),e.locations[n].paths=[]})}function p(t){var e=new paper.Point(0,(-15));Object.keys(t.locations).forEach(function(o){var c=t.locations[o],p=new paper.Path.Circle({center:c.point,radius:v*Math.ceil(Math.log10(c.population)),fillColor:"black",name:"dot"}),u=new paper.PointText(c.point+e);u.justification="center",u.fillColor="#3333ff",u.strokeColor="#9999cc",u.content=c.name,u.name="locname",u.visible=!1,u.fontSize=24;var d=new paper.Group([p,u]);d.location=c,d.onMouseEnter=n,d.onMouseLeave=a,d.onMouseDrag=r,d.onMouseDown=l,d.onMouseUp=i})}function u(t){for(var e=0;e<t.connections.length;e++){var n=t.connections[e],a=t.locations[n.loc1],o=t.locations[n.loc2],l=new paper.Path.Line(a.point,o.point);l.strokeColor="black",l.strokeWidth=f,a.paths.push(l.segments[0].point),o.paths.push(l.segments[1].point)}}function d(t,e,n,a){var o=1.05,l=t;e>0&&(l*=o),e<0&&(l/=o);var i=t/l,r=a.subtract(n),c=a.subtract(r.multiply(i)).subtract(n);return{newZoom:l,a:c}}function s(t,e,n,a){var o=new paper.Point(e,n).multiply(a);return t.subtract(o)}var v=3,f=3,h=435.3,g=-506.5,m=43647,P=15855;return $.getJSON("/map",function(t){c(t),u(t),p(t)}),$("#mapCanvas").bind("mousewheel",function(t){var e=t.originalEvent.wheelDeltaX,n=t.originalEvent.wheelDeltaY;if(t.altKey){var a=new Point(t.offsetX,t.offsetY),o=d(view.zoom,n,view.center,a);view.zoom=o.newZoom,t.preventDefault()}else view.center=s(view.center,e,n,1),t.preventDefault()}),{restrict:"A",link:function(t,e,n){paper.setup(e.get(0));var a=new paper.Layer;a.texasMap=new paper.Raster("/img/texasmap.jpg"),paper.view.center=new paper.Point(1100,500)}}})}(),function(){var t=angular.module("apox");t.controller("HelloController",function(){var t=this;t.greeting="Welcome to the Apocalypse, "})}(),function(){angular.module("apox").controller("AdminMapController",["$http",function(t){var e=this;e.closeDetails=function(){$("#detailPanel").removeClass("out")},e.updateDetails=function(){$("#detailPanel #locid").val()>0&&t.patch("/admin/map/location/"+$("#detailPanel #locid").val(),{name:$("#detailPanel #name").val(),longitude:$("#detailPanel #longitude").val(),latitude:$("#detailPanel #latitude").val(),description:$("#detailPanel #description").val(),population:$("#detailPanel #population").val(),tech:$("#detailPanel #tech").val(),type:$("#detailPanel #type").val()}).then(function(){})}}])}();